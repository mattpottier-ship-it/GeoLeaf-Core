@import url("./geoleaf-theme.css");

/* ==========================================================================
   GeoLeaf.Legend – Styles du contrôle de légende Leaflet
   ==========================================================================
   Piloté à 100 % par les variables du thème (geoleaf-theme.css)
   - Conteneur principal : .gl-layer-manager
   - Wrapper interne    : .gl-layer-manager__wrapper
   - En-tête            : .gl-layer-manager__header
   - Titre              : .gl-layer-manager__title
   - Bouton toggle      : .gl-layer-manager__toggle
   - Corps              : .gl-layer-manager__body
   - Sections           : .gl-layer-manager__section
   - Items              : .gl-layer-manager__item
   - Pastille (swatch)  : .gl-layer-manager__swatch
   ========================================================================== */

/* =======================================================================
   1. Conteneur principal Leaflet
   ======================================================================= */

.gl-layer-manager {
    /* Le contrôle Leaflet est inséré dans le container bottomright par Leaflet */
    font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI",
        sans-serif;
    font-size: 0.8rem;
    color: var(--gl-color-text-main);
}

/* Décalage vertical de la légende quand le tableau est visible */
body:has(.gl-table-panel.is-visible) .leaflet-bottom.leaflet-right {
    bottom: calc(40% + 24px);
    transition: bottom 0.3s ease-in-out;
}

/* Main wrapper : conteneur flex principal */
.gl-layer-manager__main-wrapper {
    background: var(--gl-color-legend-bg);
    color: var(--gl-color-legend-text);
    border-radius: 0.75rem;
    border: 1px solid var(--gl-color-legend-border);
    box-shadow: var(--gl-shadow-medium);

    /* Largeur augmentée pour les sélecteurs de styles et thèmes */
    width: 240px;

    /* Hauteur maximale avec flex layout */
    max-height: 400px;
    overflow: hidden;

    /* Flexbox pour que le body puisse avoir le scrollbar */
    display: flex;
    flex-direction: column;
}

/* Header wrapper : reste fixe sans scrollbar */
.gl-layer-manager__header-wrapper {
    flex-shrink: 0;
    padding: 10px 12px;
    border-bottom: 1px solid var(--gl-color-border-soft);
}

/* Body wrapper : avec scrollbar */
.gl-layer-manager__body-wrapper {
    flex: 1;
    min-height: 0;
    overflow-y: auto;
    overflow-x: hidden;
    padding: 6px 12px;

    /* Style de scrollbar personnalisé */
    scrollbar-width: thin;
    scrollbar-color: var(--gl-color-border-soft) transparent;
}

/* Scrollbar webkit pour le body wrapper */
.gl-layer-manager__body-wrapper::-webkit-scrollbar {
    width: 8px;
}

.gl-layer-manager__body-wrapper::-webkit-scrollbar-track {
    background: var(--gl-color-bg-surface-muted);
    border-radius: 4px;
}

.gl-layer-manager__body-wrapper::-webkit-scrollbar-thumb {
    background-color: var(--gl-color-border-soft);
    border-radius: 4px;
    transition: background-color 0.2s ease;
    border: 1px solid var(--gl-color-bg-surface);
}

.gl-layer-manager__body-wrapper::-webkit-scrollbar-thumb:hover {
    background-color: var(--gl-color-border-strong);
}

.gl-layer-manager__body-wrapper::-webkit-scrollbar-thumb:active {
    background-color: var(--gl-color-text-main);
}

/* Wrapper interne (ancienne structure - conservée pour compatibilité) */
.gl-layer-manager__wrapper {
    display: contents;
}

/* =======================================================================
   2. En-tête, titre et bouton de repli
   ======================================================================= */

.gl-layer-manager__header {
    display: flex;
    align-items: center;
    justify-content: space-between;
    gap: 0.5rem;
}

.gl-layer-manager__title {
    font-weight: 600;
    font-size: 0.7rem;
    letter-spacing: 0.03em;
    text-transform: uppercase;
}

.gl-layer-manager__actions {
    display: flex;
    align-items: center;
    gap: 0.25rem;
}

/* Bouton repli / dépli de la légende */
.gl-layer-manager__toggle {
    display: inline-flex;
    align-items: center;
    justify-content: center;
    width: 22px;
    height: 22px;
    border-radius: 9999px;
    border: 1px solid var(--gl-color-border-soft);
    background: var(--gl-color-bg-surface);
    color: var(--gl-color-text-main);
    cursor: pointer;
    font-size: 0.75rem;
    line-height: 1;
    box-shadow: var(--gl-shadow-soft);
    transition:
        background-color 120ms ease,
        border-color 120ms ease,
        transform 120ms ease,
        box-shadow 120ms ease;
}

.gl-layer-manager__toggle:hover {
    background: var(--gl-color-bg-surface-muted);
    border-color: var(--gl-color-border-strong);
    box-shadow: var(--gl-shadow-medium);
    transform: translateY(-1px);
}

.gl-layer-manager__toggle:active {
    transform: translateY(0);
    box-shadow: var(--gl-shadow-soft);
}

/* Icône interne (ex : chevron) */
.gl-layer-manager__toggle-icon {
    display: inline-block;
    transform-origin: center;
    transition: transform 120ms ease;
}

/* État "replié" : rotation de l’icône */
.gl-layer-manager--collapsed .gl-layer-manager__toggle-icon {
    transform: rotate(180deg);
}

/* Le corps est replié dans cet état */
.gl-layer-manager--collapsed .gl-layer-manager__body-wrapper {
    display: none;
}

/* =======================================================================
   3. Corps de la légende et sections
   ======================================================================= */

.gl-layer-manager__body {
    display: flex;
    flex-direction: column;
    gap: 6px;
}

/* Chaque section (basemaps, couches, catégories, etc.) */
.gl-layer-manager__section {
    padding-top: 4px;
    border-top: 1px solid var(--gl-color-border-soft);
    margin-top: 4px;
}

/* Section accordéon */
.gl-layer-manager__section--accordion {
    border: 1px solid var(--gl-color-border-soft);
    border-radius: 6px;
    background: var(--gl-color-bg-surface-muted);
    margin-top: 6px;
    padding: 0;
    overflow: hidden;
}

/* En-tête cliquable de l'accordéon */
.gl-layer-manager__accordion-header {
    display: flex;
    align-items: center;
    justify-content: space-between;
    padding: 8px 10px;
    background: var(--gl-color-bg-surface);
    cursor: pointer;
    user-select: none;
    transition: background-color 0.15s ease;
}

.gl-layer-manager__accordion-header:hover {
    background: var(--gl-color-bg-surface-muted);
}

/* Flèche de l'accordéon */
.gl-layer-manager__accordion-arrow {
    font-size: 0.7rem;
    color: var(--gl-color-text-muted);
    transition: transform 0.2s cubic-bezier(0.4, 0, 0.2, 1);
    will-change: transform;
}

/* Flèche pointant vers le bas quand la section est ouverte */
.gl-layer-manager__section--accordion:not(.gl-layer-manager__section--collapsed) .gl-layer-manager__accordion-arrow {
    transform: rotate(90deg);
}

/* Corps de l'accordéon */
.gl-layer-manager__accordion-body {
    display: grid;
    grid-template-rows: 1fr;
    overflow: hidden;
    transition: grid-template-rows 0.25s cubic-bezier(0.4, 0, 0.2, 1),
                padding 0.25s cubic-bezier(0.4, 0, 0.2, 1);
    padding: 8px 10px;
}

/* État collapsed : masquer le corps */
.gl-layer-manager__section--collapsed .gl-layer-manager__accordion-body {
    grid-template-rows: 0fr;
    padding: 0 10px;
}

.gl-layer-manager__accordion-body > * {
    min-height: 0;
}

/* Titre de section (ex. "Fond de carte", "Couches", "Catégories") */
.gl-layer-manager__section-title {
    font-weight: 600;
    font-size: 0.7rem;
    text-transform: uppercase;
    letter-spacing: 0.04em;
    opacity: 0.9;
    margin-bottom: 2px;
}

/* Titre dans un accordéon - pas de margin */
.gl-layer-manager__accordion-header .gl-layer-manager__section-title {
    margin-bottom: 0;
    opacity: 1;
    color: var(--gl-color-text-main);
}

.gl-layer-manager__items {
    display: flex;
    flex-direction: column;
    gap: 2px;
}

/* =======================================================================
   4. Items de légende (ligne)
   ======================================================================= */

.gl-layer-manager__item {
    display: flex;
    flex-direction: column;
    align-items: stretch;
    gap: 0;
    padding: 3px 4px;
    border-radius: 6px;
    cursor: default;
}

/* Item avec thèmes : disposition verticale */
.gl-layer-manager__item--with-themes {
    flex-direction: column;
    align-items: stretch;
    gap: 0;
}

/* Ligne principale dans un item avec thèmes */
.gl-layer-manager__item--with-themes .gl-layer-manager__item-row {
    display: flex;
    align-items: center;
    gap: 6px;
    width: 100%;
}

/* Conteneur des contrôles (toggle + flèche thème) - largeur fixe pour alignement */
.gl-layer-manager__item-controls {
    display: flex;
    align-items: center;
    gap: 4px;
    flex-shrink: 0;
    min-width: 58px; /* 36px toggle + 16px flèche + 6px gap */
    justify-content: flex-end;
}

/* Variante cliquable (ex. pour activer/désactiver une couche) */
.gl-layer-manager__item--clickable {
    cursor: pointer;
    transition:
        background-color 120ms ease,
        transform 100ms ease;
}

.gl-layer-manager__item--clickable:hover {
    background-color: var(--gl-color-overlay-soft);
    transform: translateY(-0.5px);
}

.gl-layer-manager__item--clickable:active {
    transform: translateY(0);
}

/* Label texte de l'item */
.gl-layer-manager__label {
    font-family: system-ui, -apple-system, BlinkMacSystemFont,
        "Segoe UI", sans-serif;
    font-size: 0.7rem;
    line-height: 1.3;
    color: inherit; /* suit la couleur globale de la légende */
    flex: 1;
    min-width: 0; /* permet le text-overflow */
}

/* Description plus fine (optionnelle) */
.gl-layer-manager__description {
    font-size: 0.7rem;
    color: var(--gl-color-text-muted);
    opacity: 0.92;
}

/* =======================================================================
   5. Pastilles / swatchs (couleurs, symboles)
   ======================================================================= */

.gl-layer-manager__swatch {
    position: relative;
    flex-shrink: 0;
    width: 16px;
    height: 16px;
    border-radius: 4px;
    border: 1px solid var(--gl-color-border-soft);
    background-color: var(--gl-color-bg-surface);
    box-sizing: border-box;
}

/* Pour représenter un tracé (line) */
.gl-layer-manager__swatch[data-type="line"] {
    border-radius: 9999px;
}

/* type = "circle" → disque */
.gl-layer-manager__swatch[data-type="circle"] {
    border-radius: 9999px;
}

/* Couleur : on utilise la couleur de texte courante (inherit) */
.gl-layer-manager__swatch[data-color] {
    background-color: var(--gl-color-bg-surface-muted);
    color: var(--gl-color-route-line);
}

.gl-layer-manager__swatch[data-color]::before {
    background-color: currentColor;
}

/* Trait interne pour les lignes */
.gl-layer-manager__swatch[data-type="line"]::before {
    content: "";
    position: absolute;
    inset: 50% 3px auto 3px;
    height: 2px;
    border-radius: 999px;
    transform: translateY(-50%);
}

/* Cercle interne pour les points */
.gl-layer-manager__swatch[data-type="circle"]::before {
    content: "";
    position: absolute;
    inset: 3px;
    border-radius: 999px;
}

/* Exemple : icône de catégorie (petit point coloré) */
.gl-layer-manager__swatch[data-badge="poi"]::before {
    background-color: var(--gl-color-poi-fill);
}

/* Exemple : swatch d’itinéraire (utilise la couleur de route) */
.gl-layer-manager__swatch[data-badge="route"]::before {
    background-color: var(--gl-color-route-line);
}

/* =======================================================================
   6. Ligne d’item avec badges / tags
   ======================================================================= */

.gl-layer-manager__item-main {
    display: flex;
    flex-direction: column;
    gap: 1px;
    min-width: 0;
}

.gl-layer-manager__item-meta {
    display: flex;
    flex-wrap: wrap;
    gap: 3px;
    margin-top: 1px;
}

/* Petits badges intégrés à la légende (catégorie, type, etc.) */
.gl-layer-manager__badge {
    display: inline-flex;
    align-items: center;
    gap: 0.25rem;
    padding: 0.1rem 0.35rem;
    border-radius: 999px;
    border: 1px solid var(--gl-color-border-soft);
    font-size: 0.65rem;
    line-height: 1.1;
    color: var(--gl-color-text-muted);
    background: var(--gl-color-overlay-soft);
}

.gl-layer-manager__badge-dot {
    width: 0.4rem;
    height: 0.4rem;
    border-radius: 999px;
    background: currentColor;
}

/* =======================================================================
   7. Champs de filtre / sélecteurs (optionnels)
   ======================================================================= */

.gl-layer-manager__filters {
    display: flex;
    flex-direction: column;
    gap: 4px;
    margin-top: 4px;
}

.gl-layer-manager__filter-label {
    font-size: 0.7rem;
    opacity: 0.9;
}

/* Ligne de base pour input + select dans la légende */
.gl-layer-manager__wrapper select{
    width: 100%;
    padding: 4px 6px;
    border-radius: 6px;
    border: 1px solid var(--gl-color-border-soft);
    background-color: var(--gl-color-bg-surface);
    color: var(--gl-color-text-main);
    box-sizing: border-box;

    -webkit-appearance: none;
    appearance: none;
    background-repeat: no-repeat;

    /* petite flèche neutre */
    background-image:
        linear-gradient(45deg, transparent 50%, var(--gl-color-border-soft) 50%),
        linear-gradient(135deg, var(--gl-color-border-soft) 50%, transparent 50%);
    background-size: 6px 6px, 6px 6px;
    background-position:
        calc(100% - 12px) calc(50% - 2px),
        calc(100% - 8px) calc(50% - 2px);
}

/* Sélecteur + options à l'intérieur du bloc .gl-layer-manager :
   ce sélecteur générique garantit la prise en compte de la police,
   même si le <select> n'a pas la classe gl-layer-manager__filter-select */
.gl-layer-manager select,
.gl-layer-manager option {
    font-family: cursive, system-ui, -apple-system, BlinkMacSystemFont,
        "Segoe UI", sans-serif;
    font-size: 0.75rem;
    font-weight: 500;
}

.gl-layer-manager__filter-input::placeholder {
    color: var(--gl-color-text-muted);
    opacity: 0.9;
}


/* =======================================================================
   8. Petits contrôles intégrés (toggle de couche, etc.)
   ======================================================================= */

/* Container ligne item + petit toggle à droite */
.gl-layer-manager__item-row {
    display: flex;
    align-items: center;
    justify-content: space-between;
    width: 100%;
    gap: 6px;
}

/* Conteneur des contrôles alignés à droite */
.gl-layer-manager__item-controls {
    display: flex;
    align-items: center;
    justify-content: flex-end;
    gap: 4px;
    flex-shrink: 0;
    width: 56px; /* Largeur fixe : toggle 36px + gap 4px + flèche 16px = 56px */
}

/* Toggle minimaliste type "switch" pour activer/désactiver une couche */
.gl-layer-manager__item-toggle {
    width: 36px;
    height: 20px;
    border-radius: 9999px;
    border: 2px solid var(--gl-color-border-strong);
    background: var(--gl-color-overlay-soft);
    position: relative;
    cursor: pointer;
    flex-shrink: 0;
    transition:
        background 120ms ease,
        box-shadow 120ms ease,
        transform 120ms ease,
        border-color 120ms ease;
    box-shadow: inset 0 1px 3px var(--gl-color-overlay-strong);
}

.gl-layer-manager__item-toggle::after {
    content: "";
    position: absolute;
    left: 2px;
    top: 2px;
    width: 12px;
    height: 12px;
    border-radius: 9999px;
    background: var(--gl-color-bg-surface);
    box-shadow: var(--gl-shadow-medium);
    transition:
        left 140ms ease,
        background 140ms ease,
        transform 140ms ease;
}

/* Hover pour l'état OFF */
.gl-layer-manager__item-toggle:hover {
    border-color: var(--gl-color-border-strong);
    background: var(--gl-color-overlay-strong);
}

/* État ON : utilise la couleur d'accent du thème, de manière discrète */
.gl-layer-manager__item-toggle--on {
    background: var(--gl-color-accent-soft);
    border-color: var(--gl-color-accent);
    box-shadow: var(--gl-shadow-soft);
}

.gl-layer-manager__item-toggle--on::after {
    left: 18px;
    background: var(--gl-color-bg-surface);
    transform: translateX(0) scale(1.03);
    box-shadow: var(--gl-shadow-medium);
}

/* Hover pour l'état ON */
.gl-layer-manager__item-toggle--on:hover {
    background: var(--gl-color-accent);
    border-color: var(--gl-color-accent);
}

/* État Loading : animation pulsation pendant le chargement d'une couche */
.gl-layer-manager__item-toggle--loading {
    opacity: 0.6;
    pointer-events: none;
    animation: gl-toggle-pulse 1s ease-in-out infinite;
}

.gl-layer-manager__item-toggle--loading::after {
    background: var(--gl-color-accent-soft);
}

@keyframes gl-toggle-pulse {
    0%, 100% { opacity: 0.4; }
    50% { opacity: 0.8; }
}

/* =======================================================================
   9. Responsive
   ======================================================================= */

@media (max-width: 768px) {
    .gl-layer-manager__wrapper {
        max-width: 260px;
        padding: 8px 10px;
    }

    .gl-layer-manager__title {
        font-size: 0.78rem;
    }

    .gl-layer-manager__label {

        max-width: 140px;
    }
}

/* =======================================================================
   10. Sélecteur de thèmes
   ======================================================================= */

/* Bouton toggle pour afficher/masquer le sélecteur de thème */
.gl-layer-manager__theme-toggle {
    display: inline-flex;
    align-items: center;
    justify-content: center;
    width: 16px;
    height: 16px;
    padding: 0;
    border: none;
    border-radius: 3px;
    background: var(--gl-color-bg-surface-muted, rgba(255, 255, 255, 0.1));
    color: var(--gl-color-text-muted, #888);
    cursor: pointer;
    font-size: 0.5rem;
    line-height: 1;
    transition: color 0.15s ease, background-color 0.15s ease, transform 0.15s ease;
    flex-shrink: 0;
}

/* Placeholder invisible pour maintenir l'alignement quand pas de flèche */
.gl-layer-manager__theme-toggle-placeholder {
    display: inline-block;
    width: 16px;
    height: 16px;
    flex-shrink: 0;
}

.gl-layer-manager__theme-toggle:hover {
    color: var(--gl-color-accent, #4a90d9);
    background: var(--gl-color-bg-surface-muted, rgba(255, 255, 255, 0.15));
}

.gl-layer-manager__theme-toggle--open {
    background: var(--gl-color-accent-soft, rgba(74, 144, 217, 0.2));
    color: var(--gl-color-accent, #4a90d9);
}

.gl-layer-manager__theme-toggle--open .gl-layer-manager__theme-toggle-icon {
    transform: rotate(180deg);
}

.gl-layer-manager__theme-toggle-icon {
    display: inline-block;
    transition: transform 0.2s ease;
}

/* Conteneur du sélecteur de thèmes (sous le toggle de visibilité) */
.gl-layer-manager__theme-selector {
    display: flex;
    align-items: center;
    gap: 8px;
    margin-top: 4px;
    padding: 5px 6px;
    background: var(--gl-color-bg-surface-muted, rgba(255, 255, 255, 0.08));
    border-radius: 6px;
    overflow: hidden;
    max-height: 200px;
    opacity: 1;
    transition: max-height 0.2s ease, opacity 0.2s ease, margin-top 0.2s ease, padding 0.2s ease;
}

/* État replié du sélecteur */
.gl-layer-manager__theme-selector--collapsed {
    max-height: 0;
    opacity: 0;
    margin-top: 0;
    padding-top: 0;
    padding-bottom: 0;
}

/* Label du sélecteur */
.gl-layer-manager__theme-label {
    font-size: 0.68rem;
    color: var(--gl-color-text-muted, #aaa);
    white-space: nowrap;
}

/* Loader pendant le chargement des thèmes */
.gl-layer-manager__theme-loader {
    font-size: 0.7rem;
    opacity: 0.6;
}

/* Select pour choisir le thème */
.gl-layer-manager__theme-select {
    flex: 1;
    font-size: 0.68rem;
    padding: 4px 6px;
    border: 1px solid var(--gl-color-border-soft, rgba(255, 255, 255, 0.15));
    border-radius: 4px;
    background: var(--gl-color-bg-surface, rgba(0, 0, 0, 0.3));
    color: var(--gl-color-text-main, #fff);
    cursor: pointer;
    min-width: 0;
    max-width: 100%;
    transition: border-color 0.15s ease, box-shadow 0.15s ease;
    -webkit-appearance: none;
    -moz-appearance: none;
    appearance: none;
    background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='8' height='8' viewBox='0 0 8 8'%3E%3Cpath fill='%23888' d='M0 2l4 4 4-4z'/%3E%3C/svg%3E");
    background-repeat: no-repeat;
    background-position: right 6px center;
    padding-right: 20px;
}

.gl-layer-manager__theme-select:hover {
    border-color: var(--gl-color-accent, #4a90d9);
    background: var(--gl-color-bg-surface-muted, rgba(0, 0, 0, 0.4));
}

.gl-layer-manager__theme-select:focus {
    outline: none;
    border-color: var(--gl-color-accent, #4a90d9);
    box-shadow: 0 0 0 2px var(--gl-color-accent-soft, rgba(74, 144, 217, 0.25));
}

/* Options du select (limité selon navigateur) */
.gl-layer-manager__theme-select option {
    background: var(--gl-color-bg-surface, #2a2a2a);
    color: var(--gl-color-text-main, #fff);
    padding: 4px 8px;
}
/* ========================================
   Sélecteur de styles
   ======================================== */

/* Wrapper pour le sélecteur de styles */
.gl-layer-manager__style-wrapper {
    margin-top: 6px;
    margin-bottom: 2px;
    padding-left: 0;
    width: 100%;
}

/* Conteneur du sélecteur de styles */
.gl-layer-manager__style-selector {
    display: flex;
    align-items: center;
    gap: 6px;
    padding: 4px 0;
    width: 100%;
}

/* Label du sélecteur de styles */
.gl-layer-manager__control-label {
    font-size: 0.68rem;
    color: var(--gl-color-text-muted, #aaa);
    white-space: nowrap;
    margin: 0;
    font-weight: normal;
    flex-shrink: 0;
}

/* Select pour choisir le style */
.gl-layer-manager__style-select {
    flex: 1;
    font-size: 0.68rem;
    padding: 4px 6px;
    border: 1px solid var(--gl-color-border-soft, rgba(255, 255, 255, 0.15));
    border-radius: 4px;
    background: var(--gl-color-bg-surface, rgba(0, 0, 0, 0.3));
    color: var(--gl-color-text-main, #fff);
    cursor: pointer;
    min-width: 0;
    max-width: 100%;
    transition: border-color 0.15s ease, box-shadow 0.15s ease;
    -webkit-appearance: none;
    -moz-appearance: none;
    appearance: none;
    background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='8' height='8' viewBox='0 0 8 8'%3E%3Cpath fill='%23888' d='M0 2l4 4 4-4z'/%3E%3C/svg%3E");
    background-repeat: no-repeat;
    background-position: right 6px center;
    padding-right: 20px;
}

.gl-layer-manager__style-select:hover {
    border-color: var(--gl-color-accent, #4a90d9);
    background: var(--gl-color-bg-surface-muted, rgba(0, 0, 0, 0.4));
}

.gl-layer-manager__style-select:focus {
    outline: none;
    border-color: var(--gl-color-accent, #4a90d9);
    box-shadow: 0 0 0 2px var(--gl-color-accent-soft, rgba(74, 144, 217, 0.25));
}

/* Options du select */
.gl-layer-manager__style-select option {
    background: var(--gl-color-bg-surface, #2a2a2a);
    color: var(--gl-color-text-main, #fff);
    padding: 4px 8px;
}
